<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fizika Oyunu: Nyutonun Topu (Tam Ekran)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap');
        
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh; /* Fallback */
            height: 100dvh;
            overflow: hidden;
            background-color: #87CEEB; /* Sky color fallback */
        }

        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Glassmorphism UI */
        .hud-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            height: 24px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 22px;
            width: 22px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -9px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
        
        .wind-arrow {
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- Canvas Layer -->
        <canvas id="gameCanvas"></canvas>

        <!-- UI Layer: Top Header -->
        <div class="absolute top-0 left-0 w-full p-3 md:p-4 flex justify-between items-start z-10 pointer-events-none">
            
            <!-- Title -->
            <div class="hud-panel rounded-xl px-3 py-2 pointer-events-auto">
                <h1 class="text-sm md:text-xl font-black text-slate-800 leading-none">Nyutonun Topu <span class="text-blue-600">Pro</span></h1>
            </div>

            <div class="flex gap-2 pointer-events-auto">
                <!-- Wind Indicator -->
                <div class="hud-panel px-3 py-2 rounded-xl flex flex-col items-center min-w-[70px]">
                    <span class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">K√ºl…ôk</span>
                    <div class="flex items-center gap-1 mt-1">
                        <span id="windText" class="font-bold text-slate-700 text-sm">0</span>
                        <svg id="windIcon" class="w-4 h-4 text-blue-500 wind-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </div>
                </div>

                <!-- Score -->
                <div class="hud-panel px-4 py-2 rounded-xl flex flex-col items-center min-w-[80px]">
                    <span class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">Xal</span>
                    <div id="scoreDisplay" class="text-2xl font-black text-blue-600 leading-none">0</div>
                </div>
            </div>
        </div>

        <!-- UI Layer: Bottom Controls -->
        <div class="absolute bottom-4 left-0 w-full px-4 z-10 flex justify-center pointer-events-none">
            <div class="hud-panel w-full max-w-2xl p-3 md:p-4 rounded-2xl pointer-events-auto grid grid-cols-[1fr_1fr_auto] md:grid-cols-[1.5fr_1.5fr_auto] gap-3 md:gap-6 items-center">
                
                <!-- Angle Slider -->
                <div class="flex flex-col justify-center space-y-1">
                    <div class="flex justify-between items-center text-xs font-bold text-slate-600">
                        <span>Bucaq</span>
                        <span id="angleVal" class="text-blue-600 bg-blue-50 px-1.5 rounded">45¬∞</span>
                    </div>
                    <input type="range" id="angleSlider" min="0" max="90" value="45" class="w-full">
                </div>

                <!-- Power Slider -->
                <div class="flex flex-col justify-center space-y-1">
                    <div class="flex justify-between items-center text-xs font-bold text-slate-600">
                        <span>G√ºc</span>
                        <span id="powerVal" class="text-red-600 bg-red-50 px-1.5 rounded">50%</span>
                    </div>
                    <input type="range" id="powerSlider" min="10" max="100" value="50" class="w-full">
                </div>

                <!-- Actions -->
                <div class="flex gap-2">
                    <button id="fireBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold h-12 px-6 rounded-xl shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2">
                        <span>AT∆è≈û</span> üöÄ
                    </button>
                    <button id="resetBtn" class="bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold h-12 w-12 rounded-xl shadow-sm active:scale-95 transition-transform flex items-center justify-center">
                        ‚Üª
                    </button>
                </div>
            </div>
        </div>

        <!-- Messages Overlay -->
        <div id="messageBox" class="absolute inset-0 flex items-center justify-center bg-black/30 backdrop-blur-[2px] opacity-0 pointer-events-none transition-opacity duration-300 z-50">
            <div class="bg-white p-6 rounded-3xl shadow-2xl transform scale-90 transition-transform duration-300 text-center max-w-[85%]">
                <div id="msgIcon" class="text-5xl mb-2">üéØ</div>
                <h3 id="messageTitle" class="text-2xl font-black text-slate-800 mb-1">M√∂ht…ô≈ü…ôm!</h3>
                <p id="messageSub" class="text-sm text-slate-500 font-medium">+100 Xal qazandƒ±nƒ±z</p>
            </div>
        </div>
    </div>

    <script>
        // --- Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI Refs
        const angleSlider = document.getElementById('angleSlider');
        const powerSlider = document.getElementById('powerSlider');
        const angleVal = document.getElementById('angleVal');
        const powerVal = document.getElementById('powerVal');
        const fireBtn = document.getElementById('fireBtn');
        const resetBtn = document.getElementById('resetBtn');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageSub = document.getElementById('messageSub');
        const msgIcon = document.getElementById('msgIcon');
        const windText = document.getElementById('windText');
        const windIcon = document.getElementById('windIcon');

        // Game State
        let score = 0;
        let isFiring = false;
        let wind = 0;
        let particles = [];
        let clouds = [];

        // Physics Constants
        const GRAVITY = 0.4;
        let GROUND_Y = 0; // Will be calculated

        // Objects
        let cannon = { x: 50, y: 0, width: 40, height: 20, angle: 45 };
        let ball = { x: 0, y: 0, radius: 7, vx: 0, vy: 0, trail: [] };
        let target = { x: 0, y: 0, radius: 25, hit: false };

        // Audio Setup
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;

            if (type === 'fire') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(40, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'hit') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'fail') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        // --- Core Functions ---

        function initClouds() {
            clouds = [];
            for(let i=0; i<6; i++) {
                clouds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (canvas.height * 0.5),
                    speed: 0.1 + Math.random() * 0.4,
                    size: 20 + Math.random() * 30
                });
            }
        }

        function updateWind() {
            wind = (Math.random() * 10 - 5).toFixed(1);
            const windAbs = Math.abs(wind);
            const windDir = wind > 0 ? 0 : 180;
            
            windText.textContent = `${windAbs} m/s`;
            const transform = `rotate(${windDir}deg)`;
            windIcon.style.transform = transform;
            
            const colorClass = windAbs > 3 ? 'text-red-500' : 'text-blue-500';
            windIcon.setAttribute('class', `w-4 h-4 wind-arrow ${colorClass}`);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Yer h√ºnd√ºrl√ºy√ºn√º ekranƒ±n a≈üaƒüƒ±sƒ±ndan t…ôyin edirik
            // ƒ∞dar…ôetm…ô paneli a≈üaƒüƒ±da olduƒüu √º√ß√ºn yeri biraz yuxarƒ± qaldƒ±rƒ±rƒ±q
            const isMobile = canvas.width < 768;
            const bottomOffset = isMobile ? 120 : 100; // Panel h√ºnd√ºrl√ºy√ºn√º n…ôz…ôr…ô al
            
            GROUND_Y = canvas.height - bottomOffset;
            cannon.y = GROUND_Y - 18;
            
            // Cannon position based on screen
            cannon.x = isMobile ? 30 : 60;
            
            if (target.x === 0 || target.x > canvas.width) respawnTarget();
            if (clouds.length === 0) initClouds();
            if (!isFiring) resetBall();
        }

        function respawnTarget() {
            // MOBƒ∞L PROBLEMƒ∞ H∆èLLƒ∞: H…ôd…ôfi daha uzaƒüa qoyuruq
            const isMobile = canvas.width < 768;
            
            // Ekranƒ±n enind…ôn asƒ±lƒ± olaraq minimum m…ôsaf…ô t…ôyin edirik
            // Topatan 30-60px-d…ôdir.
            // Minimum m…ôsaf…ô ekranƒ±n …ôn azƒ± 50%-i q…ôd…ôr uzaqda olmalƒ±dƒ±r.
            const minSafeDistance = Math.max(300, canvas.width * 0.5);
            
            const minX = cannon.x + minSafeDistance;
            const maxX = canvas.width - (isMobile ? 30 : 60);
            
            // ∆èg…ôr ekran √ßox ki√ßikdirs…ô v…ô minX maxX-d…ôn b√∂y√ºkd√ºrs…ô, maxX-…ô yaxƒ±n qoy
            if (minX > maxX) {
                target.x = canvas.width - 50; 
            } else {
                target.x = Math.random() * (maxX - minX) + minX;
            }

            target.radius = isMobile ? 22 : 28; 
            target.y = GROUND_Y - target.radius - 5;
            target.hit = false;
            updateWind();
        }

        function resetBall() {
            ball.x = cannon.x;
            ball.y = cannon.y;
            ball.vx = 0;
            ball.vy = 0;
            ball.trail = [];
            isFiring = false;
            
            fireBtn.disabled = false;
            fireBtn.classList.remove('opacity-70', 'cursor-not-allowed');
            fireBtn.querySelector('span').textContent = "AT∆è≈û";
            
            hideMessage();
            draw();
        }

        function createParticles(x, y, color) {
            for (let i = 0; i < 25; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color
                });
            }
        }

        function showMessage(title, text, icon) {
            messageTitle.textContent = title;
            messageSub.textContent = text;
            msgIcon.textContent = icon;
            
            messageBox.classList.remove('opacity-0', 'pointer-events-none');
            const inner = messageBox.querySelector('div');
            inner.classList.remove('scale-90');
            inner.classList.add('scale-100');
        }

        function hideMessage() {
            messageBox.classList.add('opacity-0', 'pointer-events-none');
            const inner = messageBox.querySelector('div');
            inner.classList.remove('scale-100');
            inner.classList.add('scale-90');
        }

        function fire() {
            if (isFiring) return;
            playSound('fire');
            isFiring = true;
            fireBtn.disabled = true;
            fireBtn.classList.add('opacity-70', 'cursor-not-allowed');
            fireBtn.querySelector('span').textContent = "U√áUR...";

            const angleRad = -cannon.angle * (Math.PI / 180);
            
            // Mobil √º√ß√ºn g√ºc faktoru
            const isMobile = canvas.width < 768;
            const powerFactor = isMobile ? 0.32 : 0.4; // Komp√ºterd…ô ekran b√∂y√ºkd√ºr dey…ô biraz g√ºcl√º
            const power = parseInt(powerSlider.value) * powerFactor;

            const barrelLen = 40;
            ball.x = cannon.x + Math.cos(angleRad) * barrelLen;
            ball.y = cannon.y + Math.sin(angleRad) * barrelLen;
            
            ball.vx = Math.cos(angleRad) * power;
            ball.vy = Math.sin(angleRad) * power;

            loop();
        }

        function loop() {
            // Cloud Animation
            clouds.forEach(c => {
                c.x += c.speed + (wind * 0.05);
                if(c.x > canvas.width + 50) c.x = -50;
                if(c.x < -50) c.x = canvas.width + 50;
            });

            if (isFiring) {
                ball.vy += GRAVITY;
                ball.vx += wind * 0.005;
                ball.x += ball.vx;
                ball.y += ball.vy;

                // Trail
                if (ball.trail.length === 0 || 
                    Math.hypot(ball.x - ball.trail[ball.trail.length-1].x, ball.y - ball.trail[ball.trail.length-1].y) > 8) {
                    ball.trail.push({x: ball.x, y: ball.y});
                    if (ball.trail.length > 50) ball.trail.shift();
                }

                // Collision: Target
                const dx = ball.x - target.x;
                const dy = ball.y - target.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (!target.hit && dist < (target.radius + ball.radius)) {
                    target.hit = true;
                    score += 10 + Math.abs(Math.round(wind));
                    scoreDisplay.textContent = score;
                    createParticles(target.x, target.y, "#ef4444");
                    playSound('hit');
                    showMessage("TAM M∆èRK∆èZ∆è! üéØ", `${Math.abs(Math.round(wind)) > 2 ? 'K√ºl…ôkli hava!' : '∆èla atƒ±≈ü!'}`, "üèÜ");
                    
                    isFiring = false;
                    setTimeout(() => {
                        respawnTarget();
                        resetBall();
                    }, 2000);
                }

                // Collision: Ground
                if (ball.y + ball.radius >= GROUND_Y) {
                    ball.y = GROUND_Y - ball.radius;
                    isFiring = false;
                    createParticles(ball.x, ball.y, "#94a3b8");
                    playSound('fail');
                    showMessage("YENƒ∞D∆èN C∆èHD ET", "Yer…ô d…ôydi.", "üí®");
                    setTimeout(resetBall, 1500);
                }

                // Bounds
                if (ball.x > canvas.width + 100 || ball.x < -100) {
                    isFiring = false;
                    showMessage("√áOX UZAƒûA", "Top meydandan √ßƒ±xdƒ±.", "üî≠");
                    setTimeout(resetBall, 1500);
                }
            }

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // Gravity for particles
                p.life -= 0.03;
                if (p.life <= 0) particles.splice(i, 1);
            }

            draw();
            requestAnimationFrame(loop);
        }

        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);

            // Sky
            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, "#87CEEB");
            grad.addColorStop(1, "#E0F7FA");
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Clouds
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            clouds.forEach(c => {
                ctx.beginPath();
                ctx.arc(c.x, c.y, c.size, 0, Math.PI * 2);
                ctx.arc(c.x + c.size * 0.5, c.y - c.size * 0.2, c.size * 0.8, 0, Math.PI * 2);
                ctx.arc(c.x - c.size * 0.5, c.y - c.size * 0.2, c.size * 0.8, 0, Math.PI * 2);
                ctx.fill();
            });

            // Ground Area
            ctx.fillStyle = "#4ade80";
            ctx.fillRect(0, GROUND_Y, canvas.width, canvas.height - GROUND_Y);
            ctx.fillStyle = "#22c55e"; // Border
            ctx.fillRect(0, GROUND_Y, canvas.width, 10);

            // Target
            if (!target.hit) {
                // Outer
                ctx.beginPath();
                ctx.arc(target.x, target.y, target.radius, 0, Math.PI*2);
                ctx.fillStyle = "white";
                ctx.fill();
                ctx.strokeStyle = "#ef4444";
                ctx.lineWidth = 4;
                ctx.stroke();
                
                // Inner Red
                ctx.beginPath();
                ctx.arc(target.x, target.y, target.radius * 0.6, 0, Math.PI*2);
                ctx.fillStyle = "#ef4444";
                ctx.fill();
                
                // Center
                ctx.beginPath();
                ctx.arc(target.x, target.y, target.radius * 0.2, 0, Math.PI*2);
                ctx.fillStyle = "white";
                ctx.fill();
            }

            // Trail
            if (ball.trail.length > 0) {
                ctx.beginPath();
                ctx.moveTo(ball.trail[0].x, ball.trail[0].y);
                for (let i = 1; i < ball.trail.length; i++) {
                    ctx.lineTo(ball.trail[i].x, ball.trail[i].y);
                }
                ctx.strokeStyle = "rgba(50, 50, 50, 0.4)";
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Ball
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = "#1e293b";
            ctx.fill();

            // Cannon
            ctx.save();
            ctx.translate(cannon.x, cannon.y);
            
            // Wheel
            ctx.beginPath();
            ctx.arc(0, 5, 12, 0, Math.PI*2);
            ctx.fillStyle = "#475569";
            ctx.fill();
            ctx.strokeStyle = "#1e293b";
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Spokes
            ctx.beginPath();
            ctx.moveTo(-10, 5); ctx.lineTo(10, 5);
            ctx.moveTo(0, -5); ctx.lineTo(0, 15);
            ctx.stroke();

            // Barrel
            ctx.rotate(-cannon.angle * Math.PI / 180);
            ctx.fillStyle = "#334155";
            ctx.beginPath();
            ctx.roundRect(0, -10, 45, 20, 4);
            ctx.fill();
            ctx.fillStyle = "#1e293b";
            ctx.fillRect(5, -10, 5, 20);
            ctx.restore();

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });
        }

        // --- Event Listeners ---
        function updateAngle(val) {
            angleVal.textContent = `${val}¬∞`;
            cannon.angle = parseInt(val);
            draw();
        }
        function updatePower(val) {
            powerVal.textContent = `${val}%`;
        }

        angleSlider.addEventListener('input', (e) => updateAngle(e.target.value));
        powerSlider.addEventListener('input', (e) => updatePower(e.target.value));

        fireBtn.addEventListener('click', fire);
        fireBtn.addEventListener('touchstart', (e) => { e.preventDefault(); fire(); });
        
        resetBtn.addEventListener('click', () => {
            score = 0;
            scoreDisplay.textContent = "0";
            respawnTarget();
            resetBall();
        });

        window.addEventListener('resize', () => {
            resizeCanvas();
            draw();
        });

        // Start
        setTimeout(() => {
            resizeCanvas();
            updateWind();
            loop(); 
        }, 100);

    </script>
</body>
</html>
